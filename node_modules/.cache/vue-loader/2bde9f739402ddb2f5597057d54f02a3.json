{"remainingRequest":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jlglqa/Documents/QA/noa/src/pages/track/plan/components/PackagingTest.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/jlglqa/Documents/QA/noa/src/pages/track/plan/components/PackagingTest.vue","mtime":1655949681802},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/babel-loader/lib/index.js","mtime":1644314985388},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/ts-loader/index.js","mtime":1644314987889},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js","mtime":1644314988580}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKaW1wb3J0IHt0ZXN0UGxhbkFwaX0gZnJvbSAiQC9hcGkiCmltcG9ydCB7UmVxdWVzdENyZWF0ZVBhY2thZ2luZ1Rlc3RBcHByb3ZhbH0gZnJvbSAiQC9hcGkvdHlwZXMvdGVzdFBsYW4iCmltcG9ydCB7dHlwZVBhY2thZ2luZ1Rlc3REYXRhLCB0eXBlUGxhbkRhdGF9IGZyb20gIkAvYXBpL3R5cGVzL3Rlc3RQbGFuVHlwZSIKaW1wb3J0IHZhcmlhYmxlcyBmcm9tICJAL2Fzc2V0cy9jc3MvdXRpbHMuc2NzcyIKaW1wb3J0IERpYWxvZ0Zvb3RlciBmcm9tICJAL2NvbW1vbi9jb21wb25lbnRzL0RpYWxvZ0Zvb3Rlci52dWUiCmltcG9ydCB7cGxhbkluc3RhbmNlU3RhdHVzRW51bX0gZnJvbSAnQC9jb25zdGFudC9UZXN0UGxhbicKaW1wb3J0IHtwYWNrYWdpbmdUZXN0Rm9ybSwgcGFja2FnaW5nVGVzdFJ1bGVzLCBwbGFuRm9ybX0gZnJvbSAiQC9wYWdlcy90cmFjay9wbGFuL2Zvcm1zIgppbXBvcnQge2Nsb25lRGVlcH0gZnJvbSAibG9kYXNoIgoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJQYWNrYWdpbmdUZXN0IiwKICBjb21wb25lbnRzOiB7RGlhbG9nRm9vdGVyfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZGlhbG9nRm9ybVZpc2libGU6IGZhbHNlLAogICAgICBwbGFuSW5zdGFuY2VTdGF0dXNFbnVtOiBwbGFuSW5zdGFuY2VTdGF0dXNFbnVtLAogICAgICBmb3JtOiBwYWNrYWdpbmdUZXN0Rm9ybSwKICAgICAgcnVsZXM6IHBhY2thZ2luZ1Rlc3RSdWxlcywKICAgICAgb3BlcmF0aW9uOiAnJywKICAgICAgb3duZXJPcHRpb25zOiBbXSwKICAgICAgcHJvamVjdE9wdGlvbnM6IFtdLAogICAgICBlcGljT3B0aW9uczogW10sCiAgICAgIHBsYW5PcHRpb25zOiBbXSwKICAgICAgcGlja2VyT3B0aW9uc1N0YXJ0OiB7fSwKICAgICAgdGVzdFBsYW46IHBsYW5Gb3JtLAogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGZvcm1MYWJlbFdpZHRoKCkgewogICAgICByZXR1cm4gdmFyaWFibGVzWydmb3JtTGFiZWxXaWR0aCddCiAgICB9LAogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJGV2ZW50QnVzLiRvbigncGFja2FnaW5nVGVzdFN1Ym1pdCcsICh0ZXN0UGxhbjogdHlwZVBsYW5EYXRhKSA9PiB7CiAgICAgIHRoaXMudGVzdFBsYW4gPSB0ZXN0UGxhbgogICAgICBjb25zb2xlLmxvZyh0ZXN0UGxhbikKICAgICAgdGhpcy5vcGVuKHRlc3RQbGFuKQogICAgfSkKICB9LAogIG1ldGhvZHM6IHsKICAgIG9wZW4odGVzdFBsYW46IHR5cGVQbGFuRGF0YSkgewogICAgICB0aGlzLmRpYWxvZ0Zvcm1WaXNpYmxlID0gdHJ1ZQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgaWYgKHRoaXMuJHJlZnMucGxhbkZvcm0pIHsKICAgICAgICAgIHRoaXMuJHJlZnMucGxhbkZvcm0ucmVzZXRGaWVsZHMoKQogICAgICAgIH0KICAgICAgICBpZiAodGVzdFBsYW4uYXBwcm92YWxJbnN0YW5jZSkgewogICAgICAgICAgbGV0IHRtcDogdHlwZVBhY2thZ2luZ1Rlc3REYXRhID0gY2xvbmVEZWVwKEpTT04ucGFyc2UodGVzdFBsYW4uYXBwcm92YWxJbnN0YW5jZSkpCiAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuZm9ybSwgdG1wKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLmZvcm0ubmFtZSA9IHRlc3RQbGFuLm5hbWUKICAgICAgICAgIHRoaXMuZm9ybS5yZXN1bHQgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5yZXBsYWNlKCJsaXN0IiwgdGVzdFBsYW4uaWQpCiAgICAgICAgfQogICAgICAgIHRoaXMuZm9ybS5pZCA9IHRlc3RQbGFuLmlkCiAgICAgICAgdGhpcy5mb3JtLnN0YXR1cyA9IHRlc3RQbGFuLmluc3RhbmNlU3RhdHVzCiAgICAgICAgdGhpcy5mb3JtLnJlamVjdENvdW50ID0gdGVzdFBsYW4ucmVqZWN0Q291bnQKICAgICAgICB0aGlzLmZvcm0ub3duZXJFbWFpbCA9IHRoaXMuJHN0b3JlLnN0YXRlLnVzZXJzLnVzZXJzLmZpbmQoKHM6IHsgdXNlcm5hbWU6IHN0cmluZyB9KSA9PiBzLnVzZXJuYW1lID09IHRlc3RQbGFuLm93bmVyKS5lbWFpbAogICAgICB9KQogICAgfSwKICAgIGJ1aWxkUGFyYW1zKCkgewogICAgICBsZXQgYm9keTogUmVxdWVzdENyZWF0ZVBhY2thZ2luZ1Rlc3RBcHByb3ZhbCA9IHsKICAgICAgICBuYW1lOiB0aGlzLmZvcm0ubmFtZSwKICAgICAgICBzdW1tYXJ5OiB0aGlzLmZvcm0uc3VtbWFyeSwKICAgICAgICBpbmZsdWVuY2U6IHRoaXMuZm9ybS5pbmZsdWVuY2UsCiAgICAgICAgc2VydmVyOiB0aGlzLmZvcm0uc2VydmVyLAogICAgICAgIHJlc3VsdDogdGhpcy5mb3JtLnJlc3VsdCwKICAgICAgICBwb3N0cG9uZTogdGhpcy5mb3JtLnBvc3Rwb25lLAogICAgICAgIHJlYXNvbjogdGhpcy5mb3JtLnJlYXNvbiwKICAgICAgICByZWplY3RDb3VudDogdGhpcy5mb3JtLnJlamVjdENvdW50LAogICAgICAgIHVzZXJFbWFpbDogdGhpcy4kc3RvcmUuc3RhdGUubG9naW4uZW1haWwsCiAgICAgICAgb3duZXJFbWFpbDogdGhpcy5mb3JtLm93bmVyRW1haWwsCiAgICAgICAgamlyYVByb2plY3RzOiB0aGlzLnRlc3RQbGFuLnByb2pJZHMsCiAgICAgIH0KICAgICAgcmV0dXJuIGJvZHkKICAgIH0sCiAgICBhcHByb3ZhbFN1Ym1pdCgpIHsKICAgICAgdGhpcy4kcmVmcy5wbGFuRm9ybS52YWxpZGF0ZSgodmFsaWQ6IGJvb2xlYW4pID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIGNvbnN0IGJvZHk6IFJlcXVlc3RDcmVhdGVQYWNrYWdpbmdUZXN0QXBwcm92YWwgPSB0aGlzLmJ1aWxkUGFyYW1zKCkKICAgICAgICAgIHRlc3RQbGFuQXBpLmNyZWF0ZVBhY2thZ2luZ1Rlc3RBcHByb3ZhbCh0aGlzLmZvcm0uaWQsIGJvZHkpCiAgICAgICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdyZWZyZXNoJykKICAgICAgICAgICAgfSkKICAgICAgICAgIHRoaXMuZGlhbG9nRm9ybVZpc2libGUgPSBmYWxzZQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogIH0KfQo="},{"version":3,"sources":["PackagingTest.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"PackagingTest.vue","sourceRoot":"src/pages/track/plan/components","sourcesContent":["<template>\n  <el-dialog\n    :close-on-click-modal=\"false\"\n    :visible.sync=\"dialogFormVisible\"\n    class=\"dialog-title\"\n    title=\"开发提测\"\n    width=\"65%\"\n  >\n\n    <el-form ref=\"planForm\" :model=\"form\" :rules=\"rules\" label-position=\"top\">\n      <el-form-item :label-width=\"formLabelWidth\" label=\"提测需求\" prop=\"name\">\n        <el-input v-model=\"form.name\" placeholder=\"当前版本相关需求列表\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"技术概要链接\" prop=\"summary\">\n        <el-input v-model=\"form.summary\" placeholder=\"技术&接口文档&阿波罗配置&数据库业务配置\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"影响范围\" prop=\"influence\">\n        <el-input v-model=\"form.influence\" placeholder=\"当前提测涉及到的业务影响范围\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"前后端提测服务\" prop=\"server\">\n        <el-input v-model=\"form.server\" placeholder=\"前后端提测服务及commit id\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"冒烟结果\" prop=\"result\">\n        <el-input v-model=\"form.result\" placeholder=\"附上测试平台冒烟测试计划链接\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"是否延期\" prop=\"postpone\">\n        <el-select v-model=\"form.postpone\" placeholder=\"是否延期\">\n          <el-option\n            v-for=\"item in [{text: '是', value: true}, {text: '否', value: false}]\"\n            :key=\"item.value\"\n            :label=\"item.text\"\n            :value=\"item.text\"\n          />\n        </el-select>\n      </el-form-item>\n      <el-form-item :label-width=\"formLabelWidth\" label=\"延期原因\" prop=\"reason\">\n        <el-input v-model=\"form.reason\" placeholder=\"延期原因\" type=\"textarea\"/>\n      </el-form-item>\n      <el-form-item v-if=\"form.rejectCount\" :label-width=\"formLabelWidth\" label=\"驳回次数\">\n        <div>{{ form.rejectCount }} 次</div>\n      </el-form-item>\n    </el-form>\n\n    <template slot=\"footer\">\n      <dialog-footer\n        :confirm-disable=\"form.status === planInstanceStatusEnum.PENDING\"\n        @cancel=\"dialogFormVisible = false\"\n        @confirm=\"approvalSubmit\"\n      />\n    </template>\n  </el-dialog>\n</template>\n\n<script lang=\"ts\">\nimport {testPlanApi} from \"@/api\"\nimport {RequestCreatePackagingTestApproval} from \"@/api/types/testPlan\"\nimport {typePackagingTestData, typePlanData} from \"@/api/types/testPlanType\"\nimport variables from \"@/assets/css/utils.scss\"\nimport DialogFooter from \"@/common/components/DialogFooter.vue\"\nimport {planInstanceStatusEnum} from '@/constant/TestPlan'\nimport {packagingTestForm, packagingTestRules, planForm} from \"@/pages/track/plan/forms\"\nimport {cloneDeep} from \"lodash\"\n\nexport default {\n  name: \"PackagingTest\",\n  components: {DialogFooter},\n  data() {\n    return {\n      dialogFormVisible: false,\n      planInstanceStatusEnum: planInstanceStatusEnum,\n      form: packagingTestForm,\n      rules: packagingTestRules,\n      operation: '',\n      ownerOptions: [],\n      projectOptions: [],\n      epicOptions: [],\n      planOptions: [],\n      pickerOptionsStart: {},\n      testPlan: planForm,\n    }\n  },\n  computed: {\n    formLabelWidth() {\n      return variables['formLabelWidth']\n    },\n  },\n  mounted() {\n    this.$eventBus.$on('packagingTestSubmit', (testPlan: typePlanData) => {\n      this.testPlan = testPlan\n      console.log(testPlan)\n      this.open(testPlan)\n    })\n  },\n  methods: {\n    open(testPlan: typePlanData) {\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        if (this.$refs.planForm) {\n          this.$refs.planForm.resetFields()\n        }\n        if (testPlan.approvalInstance) {\n          let tmp: typePackagingTestData = cloneDeep(JSON.parse(testPlan.approvalInstance))\n          Object.assign(this.form, tmp)\n        } else {\n          this.form.name = testPlan.name\n          this.form.result = window.location.href.replace(\"list\", testPlan.id)\n        }\n        this.form.id = testPlan.id\n        this.form.status = testPlan.instanceStatus\n        this.form.rejectCount = testPlan.rejectCount\n        this.form.ownerEmail = this.$store.state.users.users.find((s: { username: string }) => s.username == testPlan.owner).email\n      })\n    },\n    buildParams() {\n      let body: RequestCreatePackagingTestApproval = {\n        name: this.form.name,\n        summary: this.form.summary,\n        influence: this.form.influence,\n        server: this.form.server,\n        result: this.form.result,\n        postpone: this.form.postpone,\n        reason: this.form.reason,\n        rejectCount: this.form.rejectCount,\n        userEmail: this.$store.state.login.email,\n        ownerEmail: this.form.ownerEmail,\n        jiraProjects: this.testPlan.projIds,\n      }\n      return body\n    },\n    approvalSubmit() {\n      this.$refs.planForm.validate((valid: boolean) => {\n        if (valid) {\n          const body: RequestCreatePackagingTestApproval = this.buildParams()\n          testPlanApi.createPackagingTestApproval(this.form.id, body)\n            .then(() => {\n              this.$emit('refresh')\n            })\n          this.dialogFormVisible = false\n        } else {\n          return false\n        }\n      })\n    },\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}