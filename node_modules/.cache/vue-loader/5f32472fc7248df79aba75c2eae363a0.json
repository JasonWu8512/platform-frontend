{"remainingRequest":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jlglqa/Documents/QA/noa/src/pages/Team/Organization.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/jlglqa/Documents/QA/noa/src/pages/Team/Organization.vue","mtime":1655949681769},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/babel-loader/lib/index.js","mtime":1644314985388},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js","mtime":1644314988580}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBvcmdhbml6YXRpb25BcGkgZnJvbSAnQC9hcGkvb3JnYW5pemF0aW9uJwppbXBvcnQgZ2FudHQgZnJvbSAiQC9wYWdlcy9UZWFtL2NvbXBvbmVudHMvZ2FudHQiCmltcG9ydCBRcyBmcm9tICJxcyIKZXhwb3J0IGRlZmF1bHQgewpuYW1lOiAib3JnYW5pemF0aW9uIiwKICBjb21wb25lbnRzOiB7Z2FudHR9LAogIGRhdGEoKSB7CiAgcmV0dXJuIHsKICAgIGxvYWRpbmc6IGZhbHNlLAogICAgY2hlY2tlZDogZmFsc2UsCiAgICBjb25maWc6IHsKICAgICAgdGFza3M6IHt9LAogICAgICByb3dzOiB7JzEnOiB7CiAgICAgICAgICBhc3NpZ25lZTogJycsCiAgICAgICAgfX0sCiAgICAgIHRpbWU6IHtmcm9tOiAwLCB0bzogMH0KICAgIH0sCgogICAgc3RhcnRfZW5kX2RhdGU6IFtdLAogICAgZGVwYXJ0bWVudElkOiAnJywKICAgIGRlcGFydG1lbnROYW1lOiAnJywKICAgIGRlZmF1bHRQcm9wczogewogICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgbGFiZWw6ICduYW1lJywKICAgICAgdmFsdWU6ICdpZCcKICAgIH0sCiAgICBvcmdhbml6YXRpb25zOiBbXSwKICAgIGFjY291bnRPcHRpb25zOiBbXSwKICAgIHNlbGVjdGVkQWNjb3VudHM6IFtdLAogICAgcGlja2VyT3B0aW9uczogewogICAgICBzaG9ydGN1dHM6IFt7CiAgICAgICAgdGV4dDogJ+acgOi/keS4gOWRqCcsCiAgICAgICAgb25DbGljayhwaWNrZXIpIHsKICAgICAgICAgIGNvbnN0IGVuZCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCk7CiAgICAgICAgICBlbmQuc2V0VGltZShlbmQuZ2V0VGltZSgpICsgMzYwMCAqIDEwMDAgKiAyNCAqIDcpOwogICAgICAgICAgcGlja2VyLiRlbWl0KCdwaWNrJywgW3N0YXJ0LCBlbmRdKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiAn5pyA6L+R5LiA5Liq5pyIJywKICAgICAgICBvbkNsaWNrKHBpY2tlcikgewogICAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoKTsKICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoKTsKICAgICAgICAgIGVuZC5zZXRUaW1lKGVuZC5nZXRUaW1lKCkgKyAzNjAwICogMTAwMCAqIDI0ICogMzApOwogICAgICAgICAgcGlja2VyLiRlbWl0KCdwaWNrJywgW3N0YXJ0LCBlbmRdKTsKICAgICAgICB9CiAgICAgIH0sIHsKICAgICAgICB0ZXh0OiAn5pyA6L+R5LiJ5Liq5pyIJywKICAgICAgICBvbkNsaWNrKHBpY2tlcikgewogICAgICAgICAgY29uc3QgZW5kID0gbmV3IERhdGUoKTsKICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoKTsKICAgICAgICAgIGVuZC5zZXRUaW1lKGVuZC5nZXRUaW1lKCkgKyAzNjAwICogMTAwMCAqIDI0ICogOTApOwogICAgICAgICAgcGlja2VyLiRlbWl0KCdwaWNrJywgW3N0YXJ0LCBlbmRdKTsKICAgICAgICB9CiAgICAgIH1dCiAgICB9LAogIH0KICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmdldE9yZ2FuaXphdGlvbigpOwogICAgdmFyIGVuZCA9IG5ldyBEYXRlKCk7CiAgICB2YXIgc3RhcnQgPSBuZXcgRGF0ZSgpOwogICAgZW5kLnNldFRpbWUoZW5kLmdldFRpbWUoKSArIDM2MDAgKiAxMDAwICogMjQgKiAzMCkKICAgIHRoaXMuc3RhcnRfZW5kX2RhdGUgPSBbc3RhcnQuZm9ybWF0KCd5eXl5LU1NLWRkJyksIGVuZC5mb3JtYXQoJ3l5eXktTU0tZGQnKV0KICB9LAogIG1ldGhvZHM6IHsKICAgIGdldE9yZ2FuaXphdGlvbigpewogICAgICBvcmdhbml6YXRpb25BcGkuZ2V0QWNlRGVwYXJ0bWVudCh7fSkudGhlbihyZXMgPT4gewogICAgICAgIHRoaXMub3JnYW5pemF0aW9ucyA9IHJlcy5kYXRhCiAgICAgICAgdGhpcy5kZXBhcnRtZW50SWQgPSB0aGlzLm9yZ2FuaXphdGlvbnNbMF0uaWQKICAgICAgICB0aGlzLmRlcGFydG1lbnROYW1lID0gdGhpcy5vcmdhbml6YXRpb25zWzBdLm5hbWUKICAgICAgICB0aGlzLmdldEFjY291bnRCeURlcGFydG1lbnQoKQogICAgICB9KQogICAgfSwKICAgIGdldEFjY291bnRCeURlcGFydG1lbnQoKSB7CiAgICAgIG9yZ2FuaXphdGlvbkFwaS5nZXRBY2NvdW50QnlEZXBhcnRtZW50KHtvcGVuRGVwYXJ0bWVudElkOiB0aGlzLmRlcGFydG1lbnRJZH0pLnRoZW4ocmVzID0+IHsKICAgICAgICB0aGlzLmFjY291bnRPcHRpb25zID0gcmVzLmRhdGEKICAgICAgfSkKICAgIH0sCiAgICBnZXRBY2NvdW50VGFza3NHYW50dCgpIHsKICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICB0aGlzLmNvbmZpZyA9IHsKICAgICAgICB0YXNrczoge30sCiAgICAgICAgcm93czogeycxJzogewogICAgICAgICAgICBhc3NpZ25lZTogJycsCiAgICAgICAgICB9fSwKICAgICAgICB0aW1lOiB7ZnJvbTogMCwgdG86IDB9CiAgICAgIH0KICAgICAgb3JnYW5pemF0aW9uQXBpLmdldEFjY291bnRUYXNrR2FudHQoe3N0YXJ0X2RhdGU6dGhpcy5zdGFydF9lbmRfZGF0ZVswXSwgZW5kX2RhdGU6IHRoaXMuc3RhcnRfZW5kX2RhdGVbMV19LCBRcy5zdHJpbmdpZnkoe2FjY291bnRfaWRzOiB0aGlzLnNlbGVjdGVkQWNjb3VudHN9LCB7YXJyYXlGb3JtYXQ6ICdyZXBlYXQnfSkpLnRoZW4oCiAgICAgICAgcmVzID0+IHsKICAgICAgICAgIHRoaXMuY29uZmlnLnRpbWUgPSByZXMuZGF0YS50aW1lCiAgICAgICAgICByZXMuZGF0YS5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4gewogICAgICAgICAgICB0aGlzLmNvbmZpZy50YXNrc1tpdGVtWydpZCddXSA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW0sIHtzdHlsZTogeyAvLyDmr4/kuKrlnZfnmoTmoLflvI8KICAgICAgICAgICAgICAgICdib3JkZXItcmFkaXVzJzogJzFweCcsCiAgICAgICAgICAgICAgICAnYmFja2dyb3VuZCc6ICcjNGNhZWNhJwogICAgICAgICAgICAgIH19KQogICAgICAgICAgfSkKICAgICAgICAgIHJlcy5kYXRhLnJvd3MuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgdGhpcy5jb25maWcucm93c1tTdHJpbmcoaW5kZXggKyAxKV0gPSBpdGVtCiAgICAgICAgICB9KQogICAgICAgICAgfSkKICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlCiAgICB9LAogICAgaGFuZGxlTm9kZUNsaWNrKG5vZGUpewogICAgICB0aGlzLmNoZWNrZWQgPSBmYWxzZQogICAgICB0aGlzLmRlcGFydG1lbnROYW1lID0gbm9kZVt0aGlzLmRlZmF1bHRQcm9wcy5sYWJlbF0KICAgICAgdGhpcy5kZXBhcnRtZW50SWQgPSBub2RlW3RoaXMuZGVmYXVsdFByb3BzLnZhbHVlXQogICAgICB0aGlzLnNlbGVjdGVkQWNjb3VudHMgPSBbXQogICAgICBvcmdhbml6YXRpb25BcGkuZ2V0QWNjb3VudEJ5RGVwYXJ0bWVudCh7b3BlbkRlcGFydG1lbnRJZDogdGhpcy5kZXBhcnRtZW50SWR9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgdGhpcy5hY2NvdW50T3B0aW9ucyA9IHJlcy5kYXRhCiAgICAgICAgdGhpcy5jaGVja2VkID0gdHJ1ZQogICAgICAgIHRoaXMuc2VsZWN0QWxsKCkKICAgICAgfSkKICAgIH0sCiAgICBzZWxlY3RBbGwoKXsKICAgICAgdGhpcy5zZWxlY3RlZEFjY291bnRzID0gW10KICAgICAgaWYgKHRoaXMuY2hlY2tlZCkgewogICAgICAgIHRoaXMuYWNjb3VudE9wdGlvbnMubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkQWNjb3VudHMucHVzaChpdGVtLmlkKQogICAgICAgIH0pCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZWxlY3RlZEFjY291bnRzID0gW10KICAgICAgfQogICAgfSwKICAgIGNoYW5nZVNlbGVjdCh2YWwpIHsKICAgICAgdGhpcy5jaGVja2VkID0gdmFsLmxlbmd0aCA9PT0gdGhpcy5hY2NvdW50T3B0aW9ucy5sZW5ndGg7CiAgICB9LAoKICB9Cn0K"},{"version":3,"sources":["Organization.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Organization.vue","sourceRoot":"src/pages/Team","sourcesContent":["<template>\n  <el-card>\n    <el-row>\n      <el-col :span=\"4\">\n        <el-select v-model=\"departmentName\" style=\"width: 100%;padding-right: 15px\">\n          <el-option :value=\"departmentId\" style=\"height: auto\">\n            <el-tree :data=\"organizations\"\n                     :props=\"defaultProps\"\n                     node-key=\"id\"\n                     ref=\"tree\"\n                     highlight-current\n                     @node-click=\"handleNodeClick\">\n            </el-tree>\n\n          </el-option>\n        </el-select>\n      </el-col>\n      <el-col :span=\"4\">\n        <el-select v-model=\"selectedAccounts\"\n                   filterable\n                   multiple\n                   collapse-tags\n                   placeholder=\"请选择成员\" @change=\"changeSelect\"\n                   style=\"width: 100%;padding-right: 15px\">\n          <el-checkbox-button v-model=\"checked\" @change='selectAll' style=\"padding-left: 5px;\">全选</el-checkbox-button>\n          <el-option v-for=\"account in accountOptions\" :key=\"account.id\" :label=\"account.name\" :value=\"account.id\"></el-option>\n        </el-select>\n      </el-col>\n      <el-col :span=\"8\">\n        <el-date-picker\n          v-model=\"start_end_date\"\n          type=\"daterange\"\n          unlink-panels\n          range-separator=\"至\"\n          start-placeholder=\"开始日期\"\n          end-placeholder=\"结束日期\"\n          value-format=\"yyyy-MM-dd\"\n          :picker-options=\"pickerOptions\"\n          style=\"width: 100%;padding-right: 15px\">\n        </el-date-picker>\n      </el-col>\n      <el-col :span=\"2\">\n        <el-button @click=\"getAccountTasksGantt\" type=\"primary\" round>查询</el-button>\n      </el-col>\n    </el-row>\n<!--    <el-card :v-loading=\"loading\">-->\n      <gantt style=\"margin-top: 30px; border-top: 1px solid #E6E6E6\" :items=\"config\" :v-loading=\"loading\"></gantt>\n<!--    </el-card>-->\n\n  </el-card>\n</template>\n\n<script>\nimport organizationApi from '@/api/organization'\nimport gantt from \"@/pages/Team/components/gantt\"\nimport Qs from \"qs\"\nexport default {\nname: \"organization\",\n  components: {gantt},\n  data() {\n  return {\n    loading: false,\n    checked: false,\n    config: {\n      tasks: {},\n      rows: {'1': {\n          assignee: '',\n        }},\n      time: {from: 0, to: 0}\n    },\n\n    start_end_date: [],\n    departmentId: '',\n    departmentName: '',\n    defaultProps: {\n      children: 'children',\n      label: 'name',\n      value: 'id'\n    },\n    organizations: [],\n    accountOptions: [],\n    selectedAccounts: [],\n    pickerOptions: {\n      shortcuts: [{\n        text: '最近一周',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          end.setTime(end.getTime() + 3600 * 1000 * 24 * 7);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '最近一个月',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          end.setTime(end.getTime() + 3600 * 1000 * 24 * 30);\n          picker.$emit('pick', [start, end]);\n        }\n      }, {\n        text: '最近三个月',\n        onClick(picker) {\n          const end = new Date();\n          const start = new Date();\n          end.setTime(end.getTime() + 3600 * 1000 * 24 * 90);\n          picker.$emit('pick', [start, end]);\n        }\n      }]\n    },\n  }\n  },\n  mounted() {\n    this.getOrganization();\n    var end = new Date();\n    var start = new Date();\n    end.setTime(end.getTime() + 3600 * 1000 * 24 * 30)\n    this.start_end_date = [start.format('yyyy-MM-dd'), end.format('yyyy-MM-dd')]\n  },\n  methods: {\n    getOrganization(){\n      organizationApi.getAceDepartment({}).then(res => {\n        this.organizations = res.data\n        this.departmentId = this.organizations[0].id\n        this.departmentName = this.organizations[0].name\n        this.getAccountByDepartment()\n      })\n    },\n    getAccountByDepartment() {\n      organizationApi.getAccountByDepartment({openDepartmentId: this.departmentId}).then(res => {\n        this.accountOptions = res.data\n      })\n    },\n    getAccountTasksGantt() {\n      this.loading = true\n      this.config = {\n        tasks: {},\n        rows: {'1': {\n            assignee: '',\n          }},\n        time: {from: 0, to: 0}\n      }\n      organizationApi.getAccountTaskGantt({start_date:this.start_end_date[0], end_date: this.start_end_date[1]}, Qs.stringify({account_ids: this.selectedAccounts}, {arrayFormat: 'repeat'})).then(\n        res => {\n          this.config.time = res.data.time\n          res.data.items.forEach(item => {\n            this.config.tasks[item['id']] = Object.assign({}, item, {style: { // 每个块的样式\n                'border-radius': '1px',\n                'background': '#4caeca'\n              }})\n          })\n          res.data.rows.forEach((item, index) => {\n            this.config.rows[String(index + 1)] = item\n          })\n          })\n          this.loading = false\n    },\n    handleNodeClick(node){\n      this.checked = false\n      this.departmentName = node[this.defaultProps.label]\n      this.departmentId = node[this.defaultProps.value]\n      this.selectedAccounts = []\n      organizationApi.getAccountByDepartment({openDepartmentId: this.departmentId}).then(res => {\n        this.accountOptions = res.data\n        this.checked = true\n        this.selectAll()\n      })\n    },\n    selectAll(){\n      this.selectedAccounts = []\n      if (this.checked) {\n        this.accountOptions.map((item) => {\n          this.selectedAccounts.push(item.id)\n        })\n      } else {\n        this.selectedAccounts = []\n      }\n    },\n    changeSelect(val) {\n      this.checked = val.length === this.accountOptions.length;\n    },\n\n  }\n}\n</script>\n\n<style lang=\"scss\">\n.el-select-dropdown__item.hover, .el-select-dropdown__item:hover {\n  background-color: #ffffff !important;\n}\n.el-tree__empty-text {\n  top: 30% !important;\n  font-size: 12px !important;\n}\n.el-tree-node__label {\n  font-size: 12px !important;\n}\n.el-checkbox__label {\n  font-size: 12px !important;\n}\n.el-checkbox-button__inner {\n  border-radius: 4px !important;\n  border: 0 !important;\n}\n</style>\n"]}]}