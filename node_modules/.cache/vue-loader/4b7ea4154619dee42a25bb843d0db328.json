{"remainingRequest":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jlglqa/Documents/QA/noa/src/pages/autoEventTrack/components/AutoEventTrackConfigEdit.vue?vue&type=style&index=0&id=6c48dd8c&scoped=true&lang=css&","dependencies":[{"path":"/Users/jlglqa/Documents/QA/noa/src/pages/autoEventTrack/components/AutoEventTrackConfigEdit.vue","mtime":1670555139262},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/css-loader/dist/cjs.js","mtime":1644298105513},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1644314988580},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":1644298105780},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js","mtime":1644314988580}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmVsLXVwbG9hZF9fdGlwewogIGJvcmRlci1jb2xvcjogI0Y1NkM2Qwp9Cgo="},{"version":3,"sources":["AutoEventTrackConfigEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgPA;AACA;AACA","file":"AutoEventTrackConfigEdit.vue","sourceRoot":"src/pages/autoEventTrack/components","sourcesContent":["<template>\n  <el-dialog\n    :close-on-click-modal=\"false\"\n    :title=\"operation === operationEnum.EDIT? '编辑自动化配置' : '创建自动化配置'\"\n    :visible.sync=\"dialogFormVisible\"\n    class=\"dialog-title\"\n    width=\"65%\"\n  >\n    <el-form ref=\"autoEventTrackConfigForm\" :model=\"form\" :rules=\"rules\">\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"名称 :\" prop=\"name\">\n            <el-input v-model=\"form.name\" placeholder=\"请输入自动化名称\"/>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"流水线 :\" prop=\"pipelineIds\">\n            <el-select v-model=\"form.pipelineIds\" multiple filterable style=\"width: 100%;\">\n              <el-option v-for=\"item in pipelineOptions\"\n                         :key=\"item.id\"\n                         :value=\"item.name\"\n                         :label=\"item.name\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"业务线 :\" prop=\"business\">\n            <el-select v-model=\"form.business\" placeholder=\"请选择业务线\">\n              <el-option v-for=\"item in businessOptions\"\n                         :key=item\n                         :label=\"item\"\n                         :value=\"item\"\n              ></el-option>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"验证场景 :\" prop=\"method\">\n              <el-select v-model=\"form.method\" placeholder=\"请选择验证场景\">\n                <el-option\n                  v-for=\"item in methods\"\n                  :key=item\n                  :label=\"item\"\n                  :value=\"item\"\n                />\n              </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row>\n        <el-col :offset=\"1\" :span=\"20\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"环境:\" prop=\"env\">\n            <el-radio v-model=\"form.env\" label=\"fat\">fat</el-radio>\n            <el-radio v-model=\"form.env\" label=\"rc\">rc</el-radio>\n            <el-radio v-model=\"form.env\" label=\"prod\">prod</el-radio>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"定时器 :\" prop=\"crontabSchedule\">\n            <el-input v-model=\"form.crontabSchedule\" placeholder=\"请输入crontab表达式：分 小时 日 月 星期\"></el-input>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"开启定时 :\" prop=\"enableAutoTrigger\">\n            <el-radio v-model=\"form.enableAutoTrigger\" :label=\"true\">是</el-radio>\n            <el-radio v-model=\"form.enableAutoTrigger\" :label=\"false\">否</el-radio>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row>\n        <el-col :offset=\"1\" :span=\"20\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"通知群 :\" prop=\"notifyChatIds\">\n            <el-select v-model=\"form.notifyChatIds\"\n                       filterable\n                       multiple\n                       placeholder=\"请选择需要通知的群\"\n                       style=\"width: 100%;\"\n            >\n              <el-option\n                v-for=\"item in chatOptions\"\n                :key=\"item.chatId\"\n                :label=\"item.name\"\n                :value=\"item.chatId\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row class=\"import-row\">\n        <el-col :offset=\"1\" :span=\"20\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"上传Excel :\" prop=\"uploadExcel\">\n            <el-upload\n              class=\"upload-demo\"\n              action=\"\"\n              :on-change=\"handleChange\"\n              :on-exceed=\"handleExceed\"\n              :on-remove=\"handleRemove\"\n              :file-list=\"fileListUpload\"\n              :limit=\"limitUpload\"\n              accept=\"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel\"\n              :auto-upload=\"false\"\n          >\n              <el-button size=\"small\" type=\"primary\">点击导入</el-button>\n              <div slot=\"tip\" class=\"el-upload__tip\">只能上传xlsx/xls文件</div>\n            </el-upload>\n          </el-form-item>\n        </el-col>\n      </el-row>\n    </el-form>\n    <template slot=\"footer\">\n      <dialog-footer @cancel=\"dialogFormVisible = false\" @confirm=\"savePipeline\"/>\n    </template>\n  </el-dialog>\n</template>\n\n<script>\nimport {autoEventTrackApi, coverageApi} from \"@/api\"\nimport variables from \"@/assets/css/utils.scss\"\nimport DialogFooter from '@/common/components/DialogFooter.vue'\nimport {operationEnum} from \"@/constant/TestCase\"\nimport tagsSelect from '@/pages/autoEventTrack/components/tagsSelect.vue'\n\nexport default {\n  name: \"AutoEventTrackConfigEdit\",\n  // eslint-disable-next-line vue/no-unused-components\n  components: {DialogFooter,tagsSelect},\n  computed: {\n    owner() {\n      return this.$store.getters.userName;\n    },\n    formLabelWidth() {\n      return variables['formLabelWidth']\n    },\n    chatOptions() {\n      return this.$store.state.coverage.larkChats\n    }\n  },\n  data() {\n    return {\n      dialogFormVisible: false,\n      operationEnum: operationEnum,\n      pipelineOptions: [],\n      businessOptions: ['国内', '海外'],\n      operation: '',\n      methods: ['事件验证', '事件属性验证'],\n      form: {\n        name: '',\n        crontabSchedule: '',\n        enableAutoTrigger: false,\n        notifyChatIds: [],\n        business: [],\n        method: '',\n        pipelineIds: [],\n        env: 'fat',\n      },\n      rules: {\n        name: [{required: true, message: '请输入自动化配置名称', trigger: 'blur'}],\n        method: [{required: true, message: '请选择验证方式', trigger: 'blur'}],\n        env: [{required: true, message: '请选择环境', trigger: 'blur'}],\n      }\n    }\n  },\n  mounted() {\n    this.getPipelines()\n  },\n  methods: {\n    getPipelines() {\n      coverageApi.getPipelineList({offset: 0, limit: 1000}).then(res => {\n        this.pipelineOptions = res.data.data.map(item => {\n          return {\n            id: item.id,\n            name: item.name,\n          }\n        })\n      })\n    },\n    // 打开创建/编辑配置表单\n    open(autoEventTrackConfig) {\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        if (this.$refs.autoEventTrackConfigForm) {\n          this.$refs['autoEventTrackConfigForm'].resetFields()\n        }\n        this.operation = operationEnum.ADD\n        //修改\n        if (autoEventTrackConfig) {\n          this.operation = operationEnum.EDIT\n          this.form.id = autoEventTrackConfig.id\n          this.form.name = autoEventTrackConfig.name\n          this.form.method = autoEventTrackConfig.method\n          this.form.crontabSchedule = autoEventTrackConfig.crontabSchedule\n          this.form.enableAutoTrigger = autoEventTrackConfig.enableAutoTrigger\n          this.form.notifyChatIds = autoEventTrackConfig.notifyChatIds\n          this.form.business = autoEventTrackConfig.business\n          this.form.pipelineIds = autoEventTrackConfig.pipelineIds\n          this.form.env = autoEventTrackConfig.env\n        }\n      })\n    },\n    // 保存自动化配置\n    savePipeline() {\n      this.$refs['autoEventTrackConfigForm'].validate((valid) => {\n        if (valid) {\n          const params = {\n            name: this.form.name,\n            method: this.form.method,\n            crontabSchedule: this.form.crontabSchedule,\n            enableAutoTrigger: this.form.enableAutoTrigger,\n            business: this.form.business,\n            notifyChatIds: this.form.notifyChatIds,\n            pipelineIds: this.form.pipelineIds,\n            env: this.form.env,\n          }\n          if (this.operation === operationEnum.ADD) {\n            // @ts-ignore\n            params.owner = this.owner\n          } else if (this.operation === operationEnum.EDIT) {\n            params.id = this.form.id\n          }\n          autoEventTrackApi.createOrEditAutoEventTrackConfig(params).then(\n            () => {\n              this.$emit('fatherEventTrackMethod')\n            }\n          ).catch(() => {})\n          this.dialogFormVisible = false\n        } else {\n          return false\n        }\n      })\n    }\n  }\n}\n</script>\n\n<style scoped>\n.el-upload__tip{\n  border-color: #F56C6C\n}\n\n</style>\n"]}]}