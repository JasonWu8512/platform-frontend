{"remainingRequest":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jlglqa/Documents/QA/noa/src/pages/track/review/view/components/TestReviewTestCaseEdit.vue?vue&type=script&lang=ts&","dependencies":[{"path":"/Users/jlglqa/Documents/QA/noa/src/pages/track/review/view/components/TestReviewTestCaseEdit.vue","mtime":1655949681808},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/babel-loader/lib/index.js","mtime":1644314985388},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/ts-loader/index.js","mtime":1644314987889},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js","mtime":1644314988580}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgppbXBvcnQge3Rlc3RDYXNlQXBpfSBmcm9tICJAL2FwaSIKaW1wb3J0IHtSZXF1ZXN0VXBkYXRlVGVzdENhc2V9IGZyb20gIkAvYXBpL3R5cGVzL3Rlc3RUcmFjayIKaW1wb3J0IHt0eXBlQ2FzZURhdGF9IGZyb20gIkAvYXBpL3R5cGVzL3Rlc3RUcmFja1R5cGUiCmltcG9ydCB7CiAgY2FzZVR5cGVFbnVtLAogIGNhc2VUeXBlVHlwZSwKICBjYXNlVXBkYXRlVHlwZUVudW0sCiAgZXhlY3V0aW9uRW51bSwKICBleGVjdXRpb25UeXBlLAogIHByaW9yaXR5VHlwZSwKICBzdGVwU3RhdHVzRW51bSwKICBzdGVwU3RhdHVzVHlwZQp9IGZyb20gIkAvY29uc3RhbnQvVGVzdENhc2UiCmltcG9ydCB7cmV2aWV3Q2FzZVN0YXR1c0VudW19IGZyb20gIkAvY29uc3RhbnQvVGVzdFJlaXZldyIKaW1wb3J0IFRlc3RSZXZpZXdDYXNlU3RlcFN0YXR1cyBmcm9tICJAL3BhZ2VzL3RyYWNrL3Jldmlldy9jb21tb20vVGVzdFJldmlld0Nhc2VTdGVwU3RhdHVzLnZ1ZSIKCi8vIOeUqOS+i+atpemqpOaJp+ihjOe7k+aenApjb25zdCBzdGVwU3RhdHVzT3B0aW9ucyA9IE9iamVjdC5lbnRyaWVzKHN0ZXBTdGF0dXNUeXBlKS5tYXAoKFt2YWx1ZSwgdGV4dF0pID0+IHsKICByZXR1cm4ge3RleHQ6IHRleHQsIHZhbHVlOiB2YWx1ZX0KfSkKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiVGVzdFJldmlld1Rlc3RDYXNlRWRpdCIsCiAgY29tcG9uZW50czogewogICAgVGVzdFJldmlld0Nhc2VTdGVwU3RhdHVzLAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJldmlld0Nhc2VTdGF0dXNFbnVtOiByZXZpZXdDYXNlU3RhdHVzRW51bSwKICAgICAgY2FzZVR5cGVFbnVtOiBjYXNlVHlwZUVudW0sCiAgICAgIGV4ZWN1dGlvbkVudW06IGV4ZWN1dGlvbkVudW0sCiAgICAgIHByaW9yaXR5VHlwZTogcHJpb3JpdHlUeXBlLAogICAgICBleGVjdXRpb25UeXBlOiBleGVjdXRpb25UeXBlLAogICAgICBjYXNlVHlwZVR5cGU6IGNhc2VUeXBlVHlwZSwKICAgICAgc3RlcFN0YXR1c09wdGlvbnM6IHN0ZXBTdGF0dXNPcHRpb25zLAogICAgICBzaG93RGlhbG9nOiBmYWxzZSwKICAgICAgdGVzdENhc2U6IHt9LAogICAgICBpbmRleDogMCwKICAgICAgdG90YWw6IDAsCiAgICAgIHBhcmVudDogJycsCiAgICAgIHRhYmxlRGF0YTogW10sCiAgICAgIHRlc3RTdGF0dXM6ICcnLAogICAgICBhY3RpdmVUYWI6ICdkZXRhaWwnLAogICAgICBpc0ZhaWx1cmU6IHRydWUsCiAgICB9CiAgfSwKICBwcm9wczogewogICAgcmVhZE9ubHk6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0KICB9LAogIGNvbXB1dGVkOiB7CiAgICBsb2FkaW5nKCkgewogICAgICByZXR1cm4gdGhpcy4kc3RvcmUuc3RhdGUubG9hZGluZwogICAgfSwKICAgIHJldmlld0lkKCkgewogICAgICByZXR1cm4gdGhpcy4kcm91dGUucGFyYW1zLnJldmlld0lkCiAgICB9LAogICAgb2Zmc2V0KCkgewogICAgICByZXR1cm4gdGhpcy5wYXJlbnQucGFnZVNpemUgKiAodGhpcy5wYXJlbnQuY3VycmVudFBhZ2UgLSAxKQogICAgfQogIH0sCiAgaW5qZWN0OiBbJ3Byb2plY3RzJ10sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJGV2ZW50QnVzLiRvbigndGVzdFJldmlld0Nhc2VSdW4nLCAodGVzdGNhc2U6IHR5cGVDYXNlRGF0YSwgdGFibGVEYXRhOiB0eXBlQ2FzZURhdGFbXSwgcGFyZW50OiBhbnkpID0+IHsKICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQKICAgICAgdGhpcy5vcGVuKHRlc3RjYXNlLCB0YWJsZURhdGEpCiAgICB9KQogIH0sCiAgbWV0aG9kczogewogICAgY2FuY2VsKCkgewogICAgICB0aGlzLnNob3dEaWFsb2cgPSBmYWxzZQogICAgICAvLyB0aGlzLiRlbWl0KCdyZWZyZXNoJykKICAgIH0sCiAgICBzYXZlQ2FzZShzdGF0dXM6IHJldmlld0Nhc2VTdGF0dXNFbnVtKSB7CiAgICAgIHRoaXMudGVzdFN0YXR1cyA9IHN0YXR1cwogICAgICBjb25zdCBib2R5OiBSZXF1ZXN0VXBkYXRlVGVzdENhc2UgPSB7CiAgICAgICAgdHlwZTogY2FzZVVwZGF0ZVR5cGVFbnVtLlVQREFURV9SRVZJRVdfU1RBVFVTLAogICAgICAgIHN0YXR1czogc3RhdHVzLAogICAgICAgIHJldmlld0lkOiB0aGlzLnJldmlld0lkLAogICAgICB9CiAgICAgIHRlc3RDYXNlQXBpLnVwZGF0ZVRlc3RDYXNlKHRoaXMudGVzdENhc2UuaWQsIGJvZHkpCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgdGhpcy50ZXN0Q2FzZS5zdGF0dXMgPSBzdGF0dXMKICAgICAgICAgIHRoaXMuaGFuZGxlTmV4dCgpCiAgICAgICAgfSkKICAgIH0sCiAgICBhc3luYyBoYW5kbGVOZXh0KCkgewogICAgICBpZiAodGhpcy5pbmRleCArIHRoaXMub2Zmc2V0ICsgMSA9PT0gdGhpcy50b3RhbCkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIC8vIOi2hei/h+W9k+WJjemhteaAu+aVsOaXtu+8jOinpuWPkee/u+mhtQogICAgICBpZiAodGhpcy5pbmRleCArIDEgIT09IHRoaXMudGFibGVEYXRhLmxlbmd0aCkgewogICAgICAgIHRoaXMuaW5kZXgrKwogICAgICAgIHRoaXMuZ2V0VGVzdENhc2UodGhpcy5pbmRleCkKICAgICAgfSBlbHNlIHsKICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5wYXJlbnQuY3VycmVudFBhZ2UrKwogICAgICAgICAgLy8g6YeN572u5YiX6KGo57Si5byVCiAgICAgICAgICB0aGlzLmluZGV4ID0gLTEKICAgICAgICAgIGF3YWl0IHRoaXMucGFyZW50LmdldERhdGEoKQogICAgICAgICAgdGhpcy50YWJsZURhdGEgPSB0aGlzLnBhcmVudC50YWJsZURhdGEKICAgICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlTmV4dCgpCiAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAvLyDmgaLlpI3liJfooajntKLlvJUKICAgICAgICAgIHRoaXMuaW5kZXggPSB0aGlzLnBhcmVudC5wYWdlU2l6ZSAtIDEKICAgICAgICAgIHRoaXMucGFyZW50LmN1cnJlbnRQYWdlLS0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBoYW5kbGVQcmUoKSB7CiAgICAgIGlmICh0aGlzLmluZGV4ICE9PSAwKSB7CiAgICAgICAgdGhpcy5pbmRleC0tCiAgICAgICAgdGhpcy5nZXRUZXN0Q2FzZSh0aGlzLmluZGV4KQogICAgICB9IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLnBhcmVudC5jdXJyZW50UGFnZS0tCiAgICAgICAgICAvLyDph43nva7liJfooajntKLlvJUKICAgICAgICAgIHRoaXMuaW5kZXggPSB0aGlzLnBhcmVudC5wYWdlU2l6ZQogICAgICAgICAgYXdhaXQgdGhpcy5wYXJlbnQuZ2V0RGF0YSgpCiAgICAgICAgICB0aGlzLnRhYmxlRGF0YSA9IHRoaXMucGFyZW50LnRhYmxlRGF0YQogICAgICAgICAgYXdhaXQgdGhpcy5oYW5kbGVQcmUoKQogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgLy8g5oGi5aSN5YiX6KGo57Si5byVCiAgICAgICAgICB0aGlzLmluZGV4ID0gdGhpcy5wYXJlbnQucGFnZVNpemUgKyAxCiAgICAgICAgICB0aGlzLnBhcmVudC5jdXJyZW50UGFnZSsrCiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgZ2V0VGVzdENhc2UoaW5kZXg6IG51bWJlcikgewogICAgICB0aGlzLnRlc3RDYXNlID0gdGhpcy50YWJsZURhdGFbaW5kZXhdCiAgICB9LAogICAgb3Blbih0ZXN0Q2FzZTogdHlwZUNhc2VEYXRhLCB0YWJsZURhdGE6IHR5cGVDYXNlRGF0YVtdKSB7CiAgICAgIHRoaXMuYWN0aXZlVGFiID0gJ2RldGFpbCcKICAgICAgdGhpcy50b3RhbCA9IHRoaXMucGFyZW50LnRvdGFsCiAgICAgIHRoaXMudGVzdENhc2UgPSB0ZXN0Q2FzZQogICAgICB0aGlzLnRhYmxlRGF0YSA9IHRhYmxlRGF0YQogICAgICB0aGlzLmluZGV4ID0gdGhpcy50YWJsZURhdGEuaW5kZXhPZih0ZXN0Q2FzZSkKICAgICAgdGhpcy5zaG93RGlhbG9nID0gdHJ1ZQogICAgfSwKICAgIHN0ZXBSZXN1bHRDaGFuZ2UoKSB7CiAgICAgIGlmICh0aGlzLnRlc3RDYXNlLm1ldGhvZCA9PT0gZXhlY3V0aW9uRW51bS5NQU5VQUwpIHsKICAgICAgICB0aGlzLmlzRmFpbHVyZSA9IHRoaXMudGVzdENhc2UuY2FzZURldGFpbC5zdGVwcy5maWx0ZXIoKHM6IHsgYWN0dWFsU3RhdHVzOiBzdGVwU3RhdHVzRW51bSB9KSA9PiB7CiAgICAgICAgICByZXR1cm4gcy5hY3R1YWxTdGF0dXMgPT09IHN0ZXBTdGF0dXNFbnVtLkZBSUwgfHwgcy5hY3R1YWxTdGF0dXMgPT09IHN0ZXBTdGF0dXNFbnVtLkJMT0NLCiAgICAgICAgfSkubGVuZ3RoID4gMAogICAgICB9CiAgICB9LAogIH0KfQo="},{"version":3,"sources":["TestReviewTestCaseEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"TestReviewTestCaseEdit.vue","sourceRoot":"src/pages/track/review/view/components","sourcesContent":["<template>\n  <el-drawer\n    ref=\"drawer\"\n    :modal-append-to-body=\"false\"\n    :visible=\"showDialog\"\n    :with-header=\"false\"\n    close-on-press-escape\n    size=\"100%\"\n  >\n\n    <el-card class=\"container\">\n\n      <el-row class=\"cast-row\">\n\n        <!--  返回按钮  -->\n        <el-col :span=\"1\">\n          <el-button icon=\"el-icon-back\" plain size=\"mini\" @click=\"cancel\">返回</el-button>\n        </el-col>\n\n        <!--  评审操作  -->\n        <el-col :span=\"22\" class=\"head-right\">\n\n          <el-button\n            :disabled=\"index + offset + 1 <= 1\"\n            :loading=\"loading\"\n            icon=\"el-icon-arrow-up\"\n            plain\n            size=\"mini\"\n            @click=\"handlePre\"\n          />\n          <span>{{ `${index + offset + 1}/${total}` }} </span>\n          <el-button\n            :disabled=\"index + offset+ 1 >= total\"\n            :loading=\"loading\"\n            icon=\"el-icon-arrow-down\"\n            plain\n            size=\"mini\"\n            @click=\"handleNext\"\n          />\n\n          <el-divider direction=\"vertical\"/>\n\n          <el-button\n            :disabled=\"readOnly\"\n            :icon=\"testCase.status === reviewCaseStatusEnum.PASS ? 'el-icon-check' : ''\"\n            :loading=\"loading && testStatus === reviewCaseStatusEnum.PASS\"\n            size=\"mini\"\n            type=\"success\"\n            @click=\"saveCase(reviewCaseStatusEnum.PASS)\"\n          >\n            通过\n          </el-button>\n          <el-button\n            :disabled=\"readOnly\"\n            :icon=\"testCase.status === reviewCaseStatusEnum.REJECT ? 'el-icon-check' : ''\"\n            :loading=\"loading && testStatus === reviewCaseStatusEnum.REJECT\"\n            size=\"mini\"\n            type=\"danger\"\n            @click=\"saveCase(reviewCaseStatusEnum.REJECT)\"\n          >\n            未通过\n          </el-button>\n        </el-col>\n\n      </el-row>\n\n      <el-row>\n        <el-col>\n          <el-divider content-position=\"left\">{{ testCase.name }}</el-divider>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"cast-row\">\n        <el-col :offset=\"1\" :span=\"4\">\n          <span class=\"cast-label\">用例等级：</span>\n          <span>{{ priorityType[testCase.importance] }}</span>\n        </el-col>\n        <el-col :span=\"5\">\n          <span class=\"cast-label\">用例类型：</span>\n          <span>{{ caseTypeType[testCase.caseType] }}</span>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"cast-row\">\n        <el-col :offset=\"1\" :span=\"4\">\n          <span class=\"cast-label\">测试方式：</span>\n          <span>{{ executionType[testCase.executionType] }}</span>\n        </el-col>\n        <el-col :span=\"5\">\n          <span class=\"cast-label\">所属模块：</span>\n          <span>{{ testCase.treePath }}</span>\n        </el-col>\n        <el-col :span=\"4\">\n          <span class=\"cast-label\">所属项目：</span>\n          <span>{{ testCase.projName }}</span>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"cast-row\">\n        <el-col :offset=\"1\">\n          <span class=\"cast-label\">前置条件：</span>\n          <span>{{ testCase.preconditions }}</span>\n        </el-col>\n      </el-row>\n\n      <el-row v-if=\"testCase.method === executionEnum.AUTO && testCase.testId\" class=\"cast-row\">\n        <el-col :offset=\"1\" :span=\"20\" class=\"test-detail\">\n          <el-tabs v-model=\"activeTab\" type=\"border-card\">\n            <el-tab-pane label=\"测试详情\" name=\"detail\">\n              <api-test-detail\n                v-if=\"testCase.caseType === caseTypeEnum.API\"\n                :id=\"testCase.testId\"\n                ref=\"apiTestDetail\"\n                :is-read-only=\"true\"\n              />\n              <performance-test-detail\n                v-else-if=\"testCase.caseType === caseTypeEnum.PERFORMANCE\"\n                :id=\"testCase.testId\"\n                ref=\"performanceTestDetail\"\n                :is-read-only=\"true\"\n              />\n            </el-tab-pane>\n          </el-tabs>\n        </el-col>\n      </el-row>\n\n      <el-row v-if=\"testCase.executionType !== executionEnum.AUTO\" class=\"cast-row\">\n        <el-col :offset=\"1\" :span=\"21\">\n          <div class=\"cast-label\">执行步骤：</div>\n          <el-table\n            :border=\"true\"\n            :data=\"testCase.steps\"\n            :default-sort=\"{prop: 'num', order: 'ascending'}\"\n            class=\"tb-edit\"\n            highlight-current-row\n            size=\"mini\"\n          >\n            <el-table-column label=\"编号\" min-width=\"5%\" prop=\"stepNumber\"/>\n\n            <el-table-column label=\"步骤描述\" min-width=\"21%\" prop=\"actions\">\n              <template slot-scope=\"scope\">\n                <el-input\n                  v-model=\"scope.row.actions\"\n                  :autosize=\"{ minRows: 1, maxRows: 4}\"\n                  :disabled=\"true\"\n                  class=\"border-hidden\"\n                  size=\"mini\"\n                  type=\"textarea\"\n                />\n              </template>\n            </el-table-column>\n            <el-table-column label=\"预期结果\" min-width=\"21%\" prop=\"expectedresults\">\n              <template slot-scope=\"scope\">\n                <el-input\n                  v-model=\"scope.row.expectedresults\"\n                  :autosize=\"{ minRows: 1, maxRows: 4}\"\n                  :disabled=\"true\"\n                  class=\"border-hidden\"\n                  size=\"mini\"\n                  type=\"textarea\"\n                />\n              </template>\n            </el-table-column>\n            <el-table-column label=\"实际结果\" min-width=\"21%\">\n              <template slot-scope=\"scope\">\n                <el-input\n                  v-model=\"scope.row.actualResult\"\n                  :autosize=\"{ minRows: 2, maxRows: 4}\"\n                  :disabled=\"true\"\n                  :rows=\"2\"\n                  class=\"table-edit-input\"\n                  clearable\n                  placeholder=\"请输入内容\"\n                  size=\"mini\"\n                  type=\"textarea\"\n                />\n              </template>\n            </el-table-column>\n            <el-table-column label=\"步骤执行结果\" min-width=\"12%\">\n              <template slot-scope=\"scope\">\n                <el-select\n                  v-model=\"scope.row.actualStatus\"\n                  :disabled=\"true\"\n                  size=\"mini\"\n                  @change=\"stepResultChange()\"\n                >\n                  <el-option\n                    v-for=\"item in stepStatusOptions\"\n                    :key=\"item.value\"\n                    :label=\"item.text\"\n                    :value=\"item.value\"\n                  >\n                    <test-review-case-step-status :value=\"item.value\"/>\n                  </el-option>\n                </el-select>\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"cast-row\">\n        <el-col :offset=\"1\" :span=\"15\">\n          <div>\n            <span class=\"cast-label\">备注：</span>\n            <span v-if=\"!testCase.description\" style=\"color: darkgrey\">未填写</span>\n          </div>\n          <div>\n            <el-input\n              v-if=\"testCase.description\"\n              v-model=\"testCase.description\"\n              :rows=\"3\"\n              disabled\n              type=\"textarea\"\n            />\n          </div>\n        </el-col>\n      </el-row>\n    </el-card>\n\n  </el-drawer>\n</template>\n\n<script lang=\"ts\">\nimport {testCaseApi} from \"@/api\"\nimport {RequestUpdateTestCase} from \"@/api/types/testTrack\"\nimport {typeCaseData} from \"@/api/types/testTrackType\"\nimport {\n  caseTypeEnum,\n  caseTypeType,\n  caseUpdateTypeEnum,\n  executionEnum,\n  executionType,\n  priorityType,\n  stepStatusEnum,\n  stepStatusType\n} from \"@/constant/TestCase\"\nimport {reviewCaseStatusEnum} from \"@/constant/TestReivew\"\nimport TestReviewCaseStepStatus from \"@/pages/track/review/commom/TestReviewCaseStepStatus.vue\"\n\n// 用例步骤执行结果\nconst stepStatusOptions = Object.entries(stepStatusType).map(([value, text]) => {\n  return {text: text, value: value}\n})\n\nexport default {\n  name: \"TestReviewTestCaseEdit\",\n  components: {\n    TestReviewCaseStepStatus,\n  },\n  data() {\n    return {\n      reviewCaseStatusEnum: reviewCaseStatusEnum,\n      caseTypeEnum: caseTypeEnum,\n      executionEnum: executionEnum,\n      priorityType: priorityType,\n      executionType: executionType,\n      caseTypeType: caseTypeType,\n      stepStatusOptions: stepStatusOptions,\n      showDialog: false,\n      testCase: {},\n      index: 0,\n      total: 0,\n      parent: '',\n      tableData: [],\n      testStatus: '',\n      activeTab: 'detail',\n      isFailure: true,\n    }\n  },\n  props: {\n    readOnly: {\n      type: Boolean,\n      default: false\n    }\n  },\n  computed: {\n    loading() {\n      return this.$store.state.loading\n    },\n    reviewId() {\n      return this.$route.params.reviewId\n    },\n    offset() {\n      return this.parent.pageSize * (this.parent.currentPage - 1)\n    }\n  },\n  inject: ['projects'],\n  mounted() {\n    this.$eventBus.$on('testReviewCaseRun', (testcase: typeCaseData, tableData: typeCaseData[], parent: any) => {\n      this.parent = parent\n      this.open(testcase, tableData)\n    })\n  },\n  methods: {\n    cancel() {\n      this.showDialog = false\n      // this.$emit('refresh')\n    },\n    saveCase(status: reviewCaseStatusEnum) {\n      this.testStatus = status\n      const body: RequestUpdateTestCase = {\n        type: caseUpdateTypeEnum.UPDATE_REVIEW_STATUS,\n        status: status,\n        reviewId: this.reviewId,\n      }\n      testCaseApi.updateTestCase(this.testCase.id, body)\n        .then(() => {\n          this.testCase.status = status\n          this.handleNext()\n        })\n    },\n    async handleNext() {\n      if (this.index + this.offset + 1 === this.total) {\n        return\n      }\n      // 超过当前页总数时，触发翻页\n      if (this.index + 1 !== this.tableData.length) {\n        this.index++\n        this.getTestCase(this.index)\n      } else {\n        try {\n          this.parent.currentPage++\n          // 重置列表索引\n          this.index = -1\n          await this.parent.getData()\n          this.tableData = this.parent.tableData\n          await this.handleNext()\n        } catch {\n          // 恢复列表索引\n          this.index = this.parent.pageSize - 1\n          this.parent.currentPage--\n        }\n      }\n    },\n    async handlePre() {\n      if (this.index !== 0) {\n        this.index--\n        this.getTestCase(this.index)\n      } else {\n        try {\n          this.parent.currentPage--\n          // 重置列表索引\n          this.index = this.parent.pageSize\n          await this.parent.getData()\n          this.tableData = this.parent.tableData\n          await this.handlePre()\n        } catch {\n          // 恢复列表索引\n          this.index = this.parent.pageSize + 1\n          this.parent.currentPage++\n        }\n      }\n    },\n    getTestCase(index: number) {\n      this.testCase = this.tableData[index]\n    },\n    open(testCase: typeCaseData, tableData: typeCaseData[]) {\n      this.activeTab = 'detail'\n      this.total = this.parent.total\n      this.testCase = testCase\n      this.tableData = tableData\n      this.index = this.tableData.indexOf(testCase)\n      this.showDialog = true\n    },\n    stepResultChange() {\n      if (this.testCase.method === executionEnum.MANUAL) {\n        this.isFailure = this.testCase.caseDetail.steps.filter((s: { actualStatus: stepStatusEnum }) => {\n          return s.actualStatus === stepStatusEnum.FAIL || s.actualStatus === stepStatusEnum.BLOCK\n        }).length > 0\n      }\n    },\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.cast-row {\n  text-align: left;\n}\n\n.border-hidden > > > .el-textarea__inner {\n  border-style: hidden;\n  background-color: white;\n  color: #606266;\n}\n\n.cast-label {\n  color: dimgray;\n}\n\n.status-button {\n  padding-left: 4%;\n}\n\n.head-right {\n  text-align: right;\n  margin-top: 30px;\n}\n\n.el-col:not(.test-detail) {\n  line-height: 50px;\n}\n\n.issues-edit > > > p {\n  line-height: 16px;\n}\n\n.status-button {\n  float: right;\n}\n\n.head-right-tip {\n  color: darkgrey;\n}\n\n.el-scrollbar {\n  height: 100%;\n}\n\n.container {\n  height: 100%;\n  margin: 15px;\n}\n\n.el-switch > > > .el-switch__label {\n  color: dimgray;\n}\n\n.el-switch > > > .el-switch__label.is-active {\n  color: #409EFF;\n}\n\n.container > > > .el-card__body {\n  height: calc(100vh - 70px);\n}\n</style>\n"]}]}