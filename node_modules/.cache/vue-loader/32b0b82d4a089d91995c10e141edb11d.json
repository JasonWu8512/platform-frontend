{"remainingRequest":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/jlglqa/Documents/QA/noa/src/pages/track/plan/components/TestPlanEdit.vue?vue&type=style&index=0&id=01856a40&lang=scss&scoped=true&","dependencies":[{"path":"/Users/jlglqa/Documents/QA/noa/src/pages/track/plan/components/TestPlanEdit.vue","mtime":1682218382605},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/css-loader/dist/cjs.js","mtime":1644298105513},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1644314988580},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/@vue/cli-service/node_modules/postcss-loader/src/index.js","mtime":1644298105780},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/sass-loader/dist/cjs.js","mtime":1644314983366},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/cache-loader/dist/cjs.js","mtime":1644298102062},{"path":"/Users/jlglqa/Documents/QA/noa/node_modules/vue-loader/lib/index.js","mtime":1644314988580}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKQGltcG9ydCAic3JjL2Fzc2V0cy9jc3MvZGlzcGxheSI7CkBpbXBvcnQgInNyYy9hc3NldHMvY3NzL3V0aWxzIjsKCi5kaWFsb2ctdGl0bGUgewogIEBleHRlbmQgJWRpYWxvZy10aXRsZTsKfQoKLnJvdy1jb250ZW50IHsKICBtYXJnaW4tdG9wOiAxMHB4OwogIEBleHRlbmQgJWZsZXgtbGVmdC1jZW50ZXItcm93Owp9Cg=="},{"version":3,"sources":["TestPlanEdit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuXA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"TestPlanEdit.vue","sourceRoot":"src/pages/track/plan/components","sourcesContent":["<template>\n  <el-dialog\n    :close-on-click-modal=\"false\"\n    :title=\"operation === operationEnum.EDIT? '编辑测试计划' : '创建测试计划'\"\n    :visible.sync=\"dialogFormVisible\"\n    class=\"dialog-title\"\n    width=\"65%\"\n  >\n\n    <el-form ref=\"planForm\" :model=\"form\" :rules=\"rules\">\n\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"计划名称\" prop=\"name\">\n            <el-input v-model=\"form.name\" placeholder=\"请输入测试计划名称\"/>\n          </el-form-item>\n        </el-col>\n\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"所属项目\" prop=\"projIds\">\n            <el-select\n              v-model=\"form.projIds\"\n              filterable\n              multiple\n              placeholder=\"请选择所属项目\"\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"item in projectOptions\"\n                :key=\"item.id\"\n                :label=\"item.name\"\n                :value=\"item.id\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"负责人\" prop=\"owner\">\n            <el-select v-model=\"form.owner\" filterable placeholder=\"请选择负责人\" style=\"width: 100%\">\n              <el-option\n                v-for=\"item in ownerOptions\"\n                :key=\"item.value\"\n                :label=\"item.text\"\n                :value=\"item.value\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"测试阶段\" prop=\"stage\">\n            <el-select v-model=\"form.stage\" placeholder=\"请选择测试阶段\" style=\"width: 100%\">\n              <el-option\n                v-for=\"item in planStageOptions\"\n                :key=\"item.value\"\n                :label=\"item.text\"\n                :value=\"item.value\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"计划开始\" prop=\"targetStart\">\n            <el-date-picker\n              v-model=\"form.targetStart\"\n              :picker-options=\"pickerOptionsStart\"\n              placeholder=\"计划开始\"\n              style=\"width: 100%\"\n              type=\"datetime\"\n              value-format=\"yyyy-MM-dd HH:mm:ss\"\n            />\n          </el-form-item>\n        </el-col>\n\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"计划结束\" prop=\"targetEnd\">\n            <el-date-picker\n              v-model=\"form.targetEnd\"\n              :picker-options=\"pickerOptionsStart\"\n              placeholder=\"计划结束\"\n              style=\"width: 100%\"\n              type=\"datetime\"\n              value-format=\"yyyy-MM-dd HH:mm:ss\"\n            />\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row>\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"迭代\" prop=\"sprintId\">\n            <el-select\n              v-model=\"form.sprintId\"\n              filterable\n              placeholder=\"请选择sprint\"\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"item in sprintOptions\"\n                :key=\"item.id\"\n                :label=\"item.name\"\n                :value=\"item.id\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col v-if=\"form.stage === planStageEnum.SMOKE\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"对应功能测试\" prop=\"parent\">\n            <el-select\n              v-model=\"form.parent\"\n              :remote-method=\"setPlanOptions\"\n              filterable\n              placeholder=\"请选择对应功能测试计划\"\n              remote\n              style=\"width: 100%\"\n            >\n              <el-option\n                v-for=\"item in planOptions\"\n                :key=\"item.id\"\n                :label=\"item.name\"\n                :value=\"item.id\"\n              />\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n      <el-row class=\"row-content\" v-if=\"form.stage === planStageEnum.SMOKE && ['', '0',null, undefined].indexOf(form.sprintId) < 0\">\n        <el-col :offset=\"1\" :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"需求\" prop=\"storyIds\">\n            <el-select v-model=\"form.storyIds\" filterable multiple :multiple-limit=\"1\" placeholder=\"请选择冒烟需求\" style=\"width: 100%\">\n              <el-option v-for=\"item in storyOptions\"\n              :key=\"item.id\"\n              :label=\"item.summary\"\n              :value=\"item.id\"/>\n            </el-select>\n          </el-form-item>\n        </el-col>\n        <el-col :span=\"10\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"应用\" prop=\"pipelineIds\">\n            <el-select v-model=\"form.pipelineIds\" filterable multiple placeholder=\"请选择关联工程\" style=\"width: 100%\">\n              <el-option v-for=\"item in pipelineOptions\"\n              :key=\"item.id\"\n              :label=\"item.name\"\n              :value=\"item.id\"/>\n            </el-select>\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row class=\"row-content\">\n        <el-col :offset=\"1\" :span=\"20\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"描述\">\n            <el-input\n              v-model=\"form.description\"\n              :autosize=\"{ minRows: 2, maxRows: 4}\"\n              :rows=\"2\"\n              placeholder=\"请输入内容\"\n              type=\"textarea\"\n            />\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n      <el-row v-if=\"operation === operationEnum.EDIT\" class=\"row-content\">\n        <el-col :offset=\"1\" :span=\"18\">\n          <el-form-item :label-width=\"formLabelWidth\" label=\"当前状态\">\n            <test-plan-status-button\n              :show-reject=\"form.stage === planStageEnum.SMOKE\"\n              :status=\"form.status\"\n              @statusChange=\"statusChange\"\n            />\n          </el-form-item>\n        </el-col>\n      </el-row>\n\n    </el-form>\n\n    <template slot=\"footer\">\n      <dialog-footer @cancel=\"dialogFormVisible = false\" @confirm=\"savePlan\"/>\n    </template>\n  </el-dialog>\n</template>\n\n<script lang=\"ts\">\nimport {coverageApi, jiraApi, testPlanApi} from \"@/api\"\nimport {RequestCreateTestCasePlan, RequestGetTestCasePlanList, RequestUpdateTestCasePlan} from \"@/api/types/testPlan\"\nimport {typePlanData} from \"@/api/types/testPlanType\"\nimport variables from \"@/assets/css/utils.scss\"\nimport DialogFooter from '@/common/components/DialogFooter.vue'\nimport {datePickerOptionsStart} from \"@/common/utils\"\nimport {operationEnum} from \"@/constant/TestCase\"\nimport {planStageEnum, planStatusEnum} from \"@/constant/TestPlan\"\nimport TestPlanStatusButton from \"@/pages/track/plan/common/TestPlanStatusButton.vue\"\nimport {planForm, planRules} from \"@/pages/track/plan/forms\"\nimport {cloneDeep} from \"lodash\"\n\n// 计划状态\n// const planStageOptions = Object.entries(planStageType).map(([value, text]) => {\n//   return {text: text, value: value}\n// })\n\n\nexport default {\n  name: \"TestPlanEdit\",\n  components: {TestPlanStatusButton, DialogFooter},\n  data() {\n    return {\n      operationEnum: operationEnum,\n      planStageEnum: planStageEnum,\n      planStageOptions: [],\n      dialogFormVisible: false,\n      form: planForm,\n      rules: planRules,\n      operation: '',\n      ownerOptions: [],\n      projectOptions: [],\n      storyOptions: [],\n      sprintOptions: [],\n      planOptions: [],\n      pipelineOptions: [],\n      pickerOptionsStart: {},\n    }\n  },\n  props: {\n    condition: Object,\n  },\n  computed: {\n    formLabelWidth() {\n      return variables['formLabelWidth']\n    },\n  },\n  watch: {\n    'form.sprintId'() {\n      jiraApi.getStoryBySprint({sprintId: this.form.sprintId}).then(res => {\n        this.storyOptions = res.data\n      })\n    },\n    'form.projIds'() {\n      this.setSprintOptions()\n    }\n  },\n  mounted() {\n    this.$eventBus.$on('testPlanCreateOrUpdate', (testPlan: typePlanData, stage: any) => {\n      this.open(testPlan, stage)\n      console.log('sprintId', this.form.sprintId)\n    })\n    coverageApi.getPipelineList({limit: 1000}).then(res => {\n      this.pipelineOptions = res.data.data\n    })\n  },\n  methods: {\n    initOptions() {\n      this.ownerOptions = this.condition.ownerOptions\n      this.projectOptions = this.condition.projectOptions\n      this.pickerOptionsStart = datePickerOptionsStart()\n      this.setPlanOptions()\n      // this.setSprintOptions()\n    },\n    open(testPlan: typePlanData, stage: any) {\n      this.planStageOptions = stage\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.form = {\n          status: planStatusEnum.INIT,\n          name: '',\n          projIds: [],\n          projNames: [],\n          owner: '',\n          stage: '',\n          description: '',\n          targetStart: '',\n          targetEnd: '',\n          epics: [],\n          parent: ''\n        }\n        this.operation = operationEnum.ADD\n        //修改\n        if (testPlan) {\n          this.operation = operationEnum.EDIT\n          this.form = cloneDeep(testPlan)\n        }\n        this.initOptions()\n      })\n    },\n    savePlan() {\n      this.$refs.planForm.validate((valid: boolean) => {\n        if (valid) {\n          if (!this.validate()) return false\n          if (this.operation === operationEnum.ADD) {\n            const body: RequestCreateTestCasePlan = this.buildParams()\n            testPlanApi.createTestCasePlan(body)\n              .then(() => {\n                this.$emit('refresh')\n              })\n          } else if (this.operation === operationEnum.EDIT) {\n            const body: RequestUpdateTestCasePlan = this.buildParams()\n            testPlanApi.updateTestCasePlan(this.form.id, body)\n              .then(() => {\n                this.$emit('refresh')\n              })\n          }\n          this.dialogFormVisible = false\n        } else {\n          return false\n        }\n      })\n    },\n    validate() {\n      if (this.form.targetStart > this.form.targetEnd) {\n        this.$message.warning('开始日期不能大于结束日期')\n        return false\n      }\n      return true\n    },\n    buildParams() {\n      // console.log(this.form.projIds, this.projectOptions)\n      let body: RequestCreateTestCasePlan | RequestUpdateTestCasePlan = {\n        name: this.form.name,\n        stage: this.form.stage,\n        projIds: this.form.projIds,\n        projNames: this.form.projIds.map((id: any) => {\n          return this.projectOptions.find((obj: { id: any }) => obj.id === id).name\n        }),\n        owner: this.form.owner,\n        targetStart: this.form.targetStart || undefined,\n        targetEnd: this.form.targetEnd || undefined,\n        description: this.form.description,\n        storyIds: this.form.storyIds || undefined,\n        pipelineIds: this.form.pipelineIds || undefined,\n        sprintId: this.form.sprintId,\n        status: this.form.status,\n      }\n      if (body.stage === planStageEnum.SMOKE) {\n        body = Object.assign({parent: this.form.parent}, body)\n      }\n      return body\n    },\n    statusChange(status: any) {\n      this.form.status = status\n      this.$forceUpdate()\n    },\n    setPlanOptions(value?: any) {\n      const params: RequestGetTestCasePlanList = {\n        stage: planStageEnum.SYSTEM,\n        name: value || ''\n      }\n      testPlanApi.getTestCasePlanList(params)\n        .then(({data}) => {\n          this.planOptions = data.data\n        })\n    },\n    setSprintOptions() {\n      this.sprintOptions = []\n      this.form.projIds.forEach((item: any) =>{\n        console.log('proj', item)\n        jiraApi.getSprintByProject({projId: item}).then(res => {\n          this.sprintOptions = this.sprintOptions.concat(res.data.datas)\n        })\n      })\n      // jiraApi.getSprintByProject({search: value || '', epics: this.form.epics})\n      //   .then(({data}) => {\n      //     this.epicOptions = data\n      //   })\n    },\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"src/assets/css/display\";\n@import \"src/assets/css/utils\";\n\n.dialog-title {\n  @extend %dialog-title;\n}\n\n.row-content {\n  margin-top: 10px;\n  @extend %flex-left-center-row;\n}\n</style>\n"]}]}